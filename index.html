<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Pedidos Invierno AW26/27 - Abuela Tata</title>

<style>
body{font-family:Arial;padding:30px;background:#f4f4f4}
h1{margin-bottom:5px}
.section{background:white;padding:20px;margin-bottom:20px;border-radius:8px}
input,textarea{width:100%;padding:8px;margin-bottom:10px}
button{padding:10px 15px;margin-right:10px;cursor:pointer}
.product{border:1px solid #ddd;padding:15px;margin-bottom:15px;border-radius:6px}
.sizes{display:flex;flex-wrap:wrap;gap:8px;margin-top:10px}
.sizeBox{display:flex;align-items:center;gap:4px}
.sizeBox input{width:50px}
</style>
</head>

<body>

<h1>ABUELA TATA</h1>
<h3>Pedido Invierno AW26/27</h3>

<div class="section">
<h3>Datos Cliente</h3>
<input id="fiscalName" placeholder="Nombre fiscal">
<input id="taxId" placeholder="NIF / CIF">
<input id="shopName" placeholder="Nombre tienda">
<input id="email" placeholder="Email (obligatorio)">
<input id="phone" placeholder="Teléfono">
<input id="address" placeholder="Dirección">
<input id="city" placeholder="Ciudad">
<input id="zip" placeholder="Código Postal">
<input id="province" placeholder="Provincia">
<textarea id="notes" placeholder="Notas"></textarea>
</div>

<div class="section">
<h3>Añadir producto</h3>
<input id="refInput" placeholder="Introduce referencia y pulsa Enter">
<div id="products"></div>
</div>

<div class="section">
<button onclick="sendEmail()">Enviar por Email</button>
<button onclick="downloadPDF()">Descargar PDF</button>
<button onclick="saveDraft()">Guardar borrador</button>
<button onclick="loadDraft()">Cargar borrador</button>
</div>

<script>

const SIZE_MAP = {
  baby: ["3M","6M","9M","12M","18M","2A","3A","4A"],
  kid: ["12M","18M","2A","3A","4A","5A","6A","8A","10A","12A"]
};

function getSizesByRef(ref){
  if(ref.startsWith("12") || ref.startsWith("13") || ref.startsWith("11"))
    return SIZE_MAP.baby;
  if(ref.startsWith("25") || ref.startsWith("43") || ref.startsWith("22"))
    return SIZE_MAP.kid;
  return SIZE_MAP.kid;
}

document.getElementById("refInput").addEventListener("keydown",function(e){
  if(e.key==="Enter"){
    e.preventDefault();
    addProduct(this.value.trim());
    this.value="";
  }
});

function addProduct(ref){
  if(!ref) return;
  const sizes=getSizesByRef(ref);
  const div=document.createElement("div");
  div.className="product";
  div.innerHTML=`<strong>${ref}</strong><div class="sizes"></div>`;
  const sizesDiv=div.querySelector(".sizes");

  sizes.forEach(s=>{
    const box=document.createElement("div");
    box.className="sizeBox";
    box.innerHTML=`${s}<input type="number" min="0" data-size="${s}">`;
    sizesDiv.appendChild(box);
  });

  div.dataset.ref=ref;
  document.getElementById("products").appendChild(div);
}

function buildOrderText(){
  const today=new Date().toLocaleDateString("es-ES");
  const client={
    fiscalName:fiscalName.value,
    taxId:taxId.value,
    shopName:shopName.value,
    email:email.value,
    phone:phone.value,
    address:address.value,
    city:city.value,
    zip:zip.value,
    province:province.value,
    notes:notes.value
  };

  let lines="";
  document.querySelectorAll(".product").forEach(p=>{
    const ref=p.dataset.ref;
    p.querySelectorAll("input[type=number]").forEach(inp=>{
      if(inp.value>0)
        lines+=`${ref} - ${inp.dataset.size}: ${inp.value}\n`;
    });
  });

  return `
PEDIDO INVIERNO AW26/27
Fecha: ${today}

DATOS CLIENTE
Nombre fiscal: ${client.fiscalName}
NIF/CIF: ${client.taxId}
Tienda: ${client.shopName}
Email: ${client.email}
Teléfono: ${client.phone}
Dirección: ${client.address}
Ciudad: ${client.city}
CP: ${client.zip}
Provincia: ${client.province}

PEDIDO:
${lines}

Notas:
${client.notes}

All the best,
Abuela Tata
`;
}

function sendEmail(){
  if(!email.value.trim()){
    alert("Debes introducir el email del cliente.");
    return;
  }

  const subject="Pedido Invierno AW26/27 - Abuela Tata";
  const body=buildOrderText();

  window.location.href=
  `mailto:info@abuelatata.com?cc=${encodeURIComponent(email.value)}&subject=${encodeURIComponent(subject)}&body=${encodeURIComponent(body)}`;
}

function downloadPDF(){
  const win=window.open('');
  win.document.write(`<pre style="font-family:Arial;padding:30px">${buildOrderText()}</pre>`);
  win.document.close();
  win.print();
}

function saveDraft(){
  localStorage.setItem("pedidoInvierno",buildOrderText());
  alert("Borrador guardado");
}

function loadDraft(){
  const data=localStorage.getItem("pedidoInvierno");
  if(data) alert("El borrador está guardado. Revisa productos manualmente.");
}

</script>

</body>
</html>
